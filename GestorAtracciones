import java.util.HashMap;
import java.util.Scanner;

public class GestorAtracciones {
    private final HashMap<String, Atraccion> atracciones;
    private final Scanner lector;

    public GestorAtracciones(HashMap<String, Atraccion> atracciones, Scanner lector) {
        this.atracciones = atracciones;
        this.lector = lector;
    }

    public void gestionar() {
    int opcion;
    OUTER:
    while (true) {
        try {
            System.out.print("\033[H\033[2J");
            System.out.flush();
            System.out.println("GESTOR DE ATRACCIONES");
            System.out.println("");
            System.out.println("1. Crear Atraccion");
            System.out.println("2. Lista Atracciones");
            System.out.println("3. Modificar Atraccion");
            System.out.println("4. Buscar Atracciones por rango de capacidad");
            System.out.println("5. Eliminar Atraccion");
            System.out.println("6. Volver al menu principal");
            System.out.print("Escoja una opcion: ");
            opcion = lector.nextInt();
            lector.nextLine(); // Limpiar buffer de entrada
            switch (opcion) {
                case 1 -> crearAtraccion();
                case 2 -> mostrarAtracciones();
                case 3 -> modificarAtraccion();
                case 4 -> mostrarAtraccionesPorRango();
                case 5 -> eliminarAtraccion();
                case 6 -> {
                    // Opción para volver al menú principal
                    System.out.println("Volviendo al menú principal...");
                    break OUTER; // Esto rompe el ciclo y vuelve al menú
                }
                default -> System.out.println("Opción no válida. Intente nuevamente.");
            }
        } catch (Exception e) {
            System.out.println("Error, asegúrese de colocar los datos correctamente ");

            lector.nextLine(); // Limpiar buffer de entrada
        }
    }
}

    private void crearAtraccion() {
    System.out.print("\033[H\033[2J");
    System.out.flush();
    System.out.println("CREANDO ATRACCION");
    System.out.println("");
    
    Atraccion nuevaAtraccion = new Atraccion(); // Crear la instancia vacía

    System.out.print("Ingrese el nombre de la nueva atraccion: ");
    String nombreAtraccion = lector.nextLine();
    nuevaAtraccion.setNombre(nombreAtraccion); // Usar setter para nombre

    System.out.print("Ingrese la capacidad de la nueva atraccion: ");
    int capacidad = lector.nextInt();
    nuevaAtraccion.setCapacidad(capacidad); // Usar setter para capacidad

    System.out.print("Ingrese la duracion de la nueva atraccion (en minutos): ");
    int duracion = lector.nextInt();
    lector.nextLine();
    nuevaAtraccion.setDuracion(duracion); // Usar setter para duración

    atracciones.put(nombreAtraccion, nuevaAtraccion); // Añadir atracción al mapa

    System.out.println("");
    System.out.println("Atracción creada exitosamente.");
    System.out.println("Presione Enter para continuar...");
    lector.nextLine();
}


    private void mostrarAtracciones() {
        System.out.print("\033[H\033[2J");
        System.out.flush();
        System.out.println("Lista de atracciones:");
        for (Atraccion atraccion : atracciones.values()) {
            atraccion.mostrarAtraccion();  // Llama al método mostrarAtraccion
        }
        System.out.println();
        System.out.println("¿Desea ver detalles de las atracciones? (s/n)");
        String respuesta = lector.nextLine();
        System.out.println();
        boolean mostrarDetalles = respuesta.equalsIgnoreCase("s");
        for (Atraccion atraccion : atracciones.values()) {
            atraccion.mostrarAtraccion(mostrarDetalles);  // Llama al método con parámetro
        }
        System.out.println("");
        System.out.println("Presione Enter para continuar...");
        lector.nextLine();
    }

    private void modificarAtraccion() {
        System.out.print("\033[H\033[2J");
        System.out.flush();
        System.out.println("BUSCAR Y MODIFICAR ATRACCION");
        System.out.print("Ingrese el nombre de la atraccion que desea buscar: ");
        String nombreBusqueda = lector.nextLine();
    
        if (atracciones.containsKey(nombreBusqueda)) {
            Atraccion atraccion = atracciones.get(nombreBusqueda);
            System.out.println("Atraccion encontrada:");
            atraccion.mostrarAtraccion(true); // Muestra detalles, incluyendo duración

            System.out.println("¿Desea modificar esta atraccion? (s/n)");
            String respuesta = lector.nextLine();
            if (respuesta.equalsIgnoreCase("s")) {
                System.out.print("Ingrese el nuevo nombre de la atraccion (deje en blanco para mantener el actual): ");
                String nuevoNombre = lector.nextLine();
                if (!nuevoNombre.isEmpty()) {
                    atracciones.remove(nombreBusqueda); // Elimina la entrada antigua
                    atraccion.setNombre(nuevoNombre);
                    atracciones.put(nuevoNombre, atraccion); // Agrega la nueva entrada
                }

                System.out.print("Ingrese la nueva capacidad de la atraccion (deje en blanco para mantener la actual): ");
                String nuevaCapacidad = lector.nextLine();
                if (!nuevaCapacidad.isEmpty()) {
                    atraccion.setCapacidad(Integer.parseInt(nuevaCapacidad));
                }

                System.out.print("Ingrese la nueva duración de la atraccion (deje en blanco para mantener la actual): ");
                String nuevaDuracion = lector.nextLine();
                if (!nuevaDuracion.isEmpty()) {
                    atraccion.setDuracion(Integer.parseInt(nuevaDuracion));
                }

                System.out.println("Atraccion modificada exitosamente.");
            }
        } else {
            System.out.println("Atraccion no encontrada.");
        }

        System.out.println("Presione Enter para continuar...");
        lector.nextLine();
    }

    private void mostrarAtraccionesPorRango() {
        System.out.print("\033[H\033[2J");
        System.out.flush();
        System.out.println("MOSTRAR ATRACCIONES POR RANGO DE CAPACIDAD");
        System.out.print("Ingrese la capacidad mínima: ");
        int capacidadMin = lector.nextInt();
        System.out.print("Ingrese la capacidad máxima: ");
        int capacidadMax = lector.nextInt();
        lector.nextLine(); // Limpiar el buffer

        System.out.println("\nAtracciones en el rango de capacidad:");
        for (Atraccion atraccion : atracciones.values()) {
            if (atraccion.getCapacidad() >= capacidadMin && atraccion.getCapacidad() <= capacidadMax) {
                atraccion.mostrarAtraccion();
            }
        }

        System.out.println("Presione Enter para continuar...");
        lector.nextLine();
    }

    private void eliminarAtraccion() {
        System.out.print("\033[H\033[2J");
        System.out.flush();
        System.out.println("ELIMINAR ATRACCION");
        System.out.println("");
        int i = 1;
        for (String nombre : atracciones.keySet()) {
            System.out.println(i + ". " + nombre);
            i++;
        }
        System.out.print("Ingrese el nombre de la atracción a eliminar: ");
        String nombreEliminar = lector.nextLine();
        if (atracciones.containsKey(nombreEliminar)) {
            atracciones.remove(nombreEliminar);
            System.out.println("Atracción eliminada exitosamente.");
        } else {
            System.out.println("Atracción no encontrada.");
        }
        System.out.println("Presione Enter para continuar...");
        lector.nextLine();
    }
}
